<!DOCTYPE html>
<html>

<head>
	<title>CaMapper-Admin privileges</title>
	<meta name="viewport" content="initial-scale=1.0">
	<meta charset="utf-8">
	<style>
		#map {
			height: 100%;
		}

		html,
		body {
			height: 100%;
			margin: 0;
			padding: 0;
		}
	</style>

</head>

<body>
	<div id="map"></div>
	<button id="bringToCenter">Bring to Center</button>
	<script>
		markerIcon = 'images/markerIcon.png';


		var campingSiteInfo = {
			siteName: 'defaultSiteName',
			costMoney: 'Default-free',
			fireAllowed: "Default-No",
			toString: function() {
				return ("" + this.siteName + "\n" +
					this.costMoney + "\n" +
					this.fireAllowed + "\n");

			}
		}

		let map;
		var infoWindowLatLang;
		var specificPlace = Object.create(campingSiteInfo);

		function initMap() {
			//setting the map starting position and zoom.
			map = new google.maps.Map(document.getElementById('map'), {
				center: {
					lat: 32.01345951663715,
					lng: 34.77160817977713
				},
				zoom: 7
			});

			//setting a center button that will get us back to the begininng position.

			const centerButton = document.querySelector('#bringToCenter');

			centerButton.addEventListener('click', function(e) {
				e.preventDefault();
				map.setCenter({
					lat: 32.01345951663715,
					lng: 34.77160817977713
				});
			});


			//getting coaordinates from pressing on screen.


			map.addListener('click', function(mapsMouseEvent) {
				if (infoWindowLatLang) infoWindowLatLang.close();

				infoWindowLatLang = new google.maps.InfoWindow({
					position: mapsMouseEvent.latLng
				});

				infoWindowLatLang.setContent(mapsMouseEvent.latLng.toString());
				infoWindowLatLang.open(map);
			});



			//adding a pin option so a user can pin a specific location.

			function MarkerControl(controlDiv, map) {
				const controlUI = document.createElement('div');
				controlUI.style.backgroundColor = '#fff';
				controlUI.style.border = '2px solid #fff';
				controlUI.style.borderRadius = '3px';
				controlUI.style.boxShadow = '0 2px 6px rgba(0,0,0,.3)';
				controlUI.style.cursor = 'pointer';
				controlUI.style.margin = '10px';
				controlDiv.appendChild(controlUI);

				const controlText = document.createElement('img');
				controlText.style.padding = '5px';
				controlText.title = 'Click to add a new location to the database and map';
				controlText.src = 'http://maps.google.com/mapfiles/kml/shapes/campfire.png';
				controlText.size = '10px'
				controlUI.appendChild(controlText);

				controlUI.addEventListener('click', function() {

						//add click actions here

						document.location.href = '/addNewLocation';



					}

				);
			}



			//////////////////////////////////////////////////






			////////////////////////////////////////////////////

			const markerControlDiv = document.createElement('div');
			const markerControl = new MarkerControl(markerControlDiv, map);
			markerControlDiv.index = 1;
			map.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(markerControlDiv);



			// Add multiple markers to map
			var markersLocations = locationsLoaded.getLatLang();
			const infoWindow = new google.maps.InfoWindow({
				content: "empty for now",
				minWidth: 200,
				minHeight: 200,
			});

			for (let i = 0; i < markersLocations.length; i++) {

				let currMarkerPosition = markersLocations[i];

				let marker = new google.maps.Marker({
					position: currMarkerPosition,
					icon: markerIcon,
					title: locationsLoaded.getLocationInfo()[i].name,
					info: locationsLoaded.getLocationInfo()[i].info,
					englishName: locationsLoaded.getLocationInfo()[i].englishName,
					swimmingOption: locationsLoaded.getLocationInfo()[i].swimmingOption,
					waterSource: locationsLoaded.getLocationInfo()[i].waterSource,
					costMoney: locationsLoaded.getLocationInfo()[i].costMoney,
					toiletAvailable: locationsLoaded.getLocationInfo()[i].toiletAvailable,
					map: map
				});



				marker.addListener('click', function() {
					console.log("marker clicked");

					var markerValues = JSON.stringify({
						values:{
							swimmingOption: locationsLoaded.getLocationInfo()[i].swimmingOption,
							waterSource: locationsLoaded.getLocationInfo()[i].waterSource,
							costMoney: locationsLoaded.getLocationInfo()[i].costMoney,
							toiletAvailable: locationsLoaded.getLocationInfo()[i].toiletAvailable,
							englishName: locationsLoaded.getLocationInfo()[i].englishName
						}
					});
					let parsedMarkerValues = JSON.parse(markerValues);

					console.log(parsedMarkerValues);


					let tempContent = (
						'<div id="content" dir="rtl">' +
						'<div id="siteNotice">' +
						"</div>" +
						'<h1 style="color: SeaGreen; id="firstHeading" class="firstHeading">' + marker.title + '</h1>' +
						'<div id="bodyContent">' +
						"<p style='font-size:20px'><b>" + "מותר לשחות?" + "\t" + parsedMarkerValues.values.swimmingOption + "</b>." +
						"<p style='font-size:20px'><b>" + "מקור מים?" + "\t" + parsedMarkerValues.values.waterSource + "</b>." +
						"<p style='font-size:20px'><b>" + "עלות כספית?" + "\t" + parsedMarkerValues.values.costMoney + "</b>." +
						"<p style='font-size:20px'><b>" + "שרותים זמינים באתר?" + "\t" + parsedMarkerValues.values.toiletAvailable + "</b>." +
						// "<p style='font-size:20px'><b>"+marker.info+"</b>,"+
						'<p><a style="font-size: 30px"+ href=/' + "locations/" + marker.englishName + '?locationValuesFromDb=' + markerValues + '>לחץ כאן למידע מורחב</a>' +
						"</div>" +
						"</div>")

					infoWindow.setContent(tempContent);
					infoWindow.minHeight = 300;
					infoWindow.minWidth = 300;

					infoWindow.open(map, marker);

				});

			}

		}
	</script>


	<script>
		//script to load markers from the Db into a variable called locationsLoaded

		function httpGet(theUrl) {
			let xmlHttpReq = new XMLHttpRequest();
			xmlHttpReq.open("GET", theUrl, false);
			xmlHttpReq.send(null);
			return xmlHttpReq.responseText;
		}
		var locationsLoaded = JSON.parse(httpGet("http://localhost:3000/getLocations"));


		//parsing the information received from DB into object i can use

		locationsLoaded.getLatLang = function() {

			var latLangArr = [];

			this.forEach(location => {
				latLangArr.push({
					lat: parseFloat(location.latitude),
					lng: parseFloat(location.longitude)
				});
			});
			return latLangArr;
		}

		locationsLoaded.getLocationInfo = function() {

			var locationInfoArr = [];

			this.forEach(location => {
				locationInfoArr.push({
					name: location.name,
					info: location.info,
					englishName: location.englishName,
					swimmingOption: location.swimmingOption,
					waterSource: location.waterSource,
					costMoney: location.costMoney,
					toiletAvailable: location.toiletAvailable
				});
			});
			return locationInfoArr;

		}
	</script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD2EAjv1tOnx4DCctrhz-mNsDrfaidp_yI&callback=initMap" async defer></script>





</body>

</html>
